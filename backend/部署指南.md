# 后端部署指南

## 方案一：使用 Vercel 部署（推荐 - 免费）

### 步骤：

1. **安装 Vercel CLI**
```bash
npm install -g vercel
```

2. **登录 Vercel**
```bash
vercel login
```

3. **部署后端**
```bash
cd backend
vercel
```

4. **跟随提示完成部署**
   - Set up and deploy? → Yes
   - Which scope? → 选择你的账号
   - Link to existing project? → No
   - Project name? → love-test-backend
   - In which directory? → ./
   - Auto-detected settings? → Yes

5. **记录部署后的URL**
   - Vercel会返回一个URL，例如：`https://love-test-backend.vercel.app`

6. **更新前端API地址**
   - 打开 `src/components/AuthCodeModal.jsx`
   - 将第21行的 `http://localhost:3001` 改为你的Vercel URL
   ```javascript
   const response = await fetch('https://你的vercel域名.vercel.app/api/verify-code', {
   ```

---

## 方案二：使用 Render 部署（免费）

### 步骤：

1. 访问 https://render.com
2. 注册/登录账号
3. 点击 "New +" → "Web Service"
4. 连接你的 GitHub 仓库
5. 配置：
   - Name: `love-test-backend`
   - Environment: `Node`
   - Build Command: `npm install`
   - Start Command: `npm start`
   - Branch: `main`
   - Root Directory: `backend`
6. 点击 "Create Web Service"
7. 等待部署完成，记录URL

---

## 方案三：使用 Railway 部署（免费）

### 步骤：

1. 访问 https://railway.app
2. 注册/登录账号
3. 点击 "New Project" → "Deploy from GitHub repo"
4. 选择你的仓库
5. 配置：
   - Root Directory: `backend`
   - Start Command: `npm start`
6. 添加环境变量（如需要）
7. 部署完成后记录URL

---

## 部署后需要做的事情

### 1. 更新前端API地址

找到前端代码中所有 `http://localhost:3001` 的地方，替换为你的后端URL：

**文件位置：** `src/components/AuthCodeModal.jsx`

```javascript
// 第21行左右
const response = await fetch('你的后端URL/api/verify-code', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ code: code.toUpperCase() }),
});
```

### 2. 重新部署前端

```bash
git add .
git commit -m "更新后端API地址"
git push origin master:main
```

### 3. 测试

访问 https://734183178.github.io/youxi/xinlitest.html 测试授权码功能

---

## 可用的测试授权码

- LOVE2025
- TEST1234
- DEMO5678
- SWEET001
- HEART999

---

## 管理授权码

访问后端URL的管理面板：
```
你的后端URL/api/codes?adminKey=admin123
```

生成新的授权码：
```bash
curl -X POST 你的后端URL/api/generate-code \
  -H "Content-Type: application/json" \
  -d '{"count": 10, "adminKey": "admin123"}'
```

---

## 注意事项

⚠️ **重要**：
1. 部署后记得修改 `adminKey`（默认是 `admin123`）
2. 授权码数据存储在内存中，服务重启后会丢失
3. 生产环境建议使用真实数据库（MongoDB、PostgreSQL等）
4. 需要配置CORS允许你的前端域名访问

---

## 故障排查

如果遇到CORS错误：
1. 检查后端的CORS配置
2. 确认前端使用的是HTTPS
3. 在Vercel中添加环境变量配置CORS源

如果授权码验证失败：
1. 检查API地址是否正确
2. 查看浏览器控制台的网络请求
3. 确认后端服务正常运行
