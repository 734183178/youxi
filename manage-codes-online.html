<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCL-90 å…‘æ¢ç ç®¡ç†å·¥å…· - çº¿ä¸Šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
            <h3 class="text-red-800 font-semibold mb-2">ğŸš¨ çº¿ä¸Šç‰ˆç®¡ç†è¯´æ˜</h3>
            <div class="text-red-700 text-sm space-y-1">
                <p>â€¢ GitHub Pagesä¸æ”¯æŒåŠ¨æ€å†™å…¥æ–‡ä»¶ï¼Œæ— æ³•ç›´æ¥åœ¨çº¿æ·»åŠ å…‘æ¢ç </p>
                <p>â€¢ è¯·ä½¿ç”¨ä¸‹æ–¹å·¥å…·ç”Ÿæˆæ–°å…‘æ¢ç ï¼Œç„¶åæ‰‹åŠ¨æ›´æ–°GitHubä»“åº“ä¸­çš„æ–‡ä»¶</p>
                <p>â€¢ æ“ä½œæ­¥éª¤ï¼šç”Ÿæˆä»£ç  â†’ å¤åˆ¶JSON â†’ åœ¨GitHubä»“åº“ä¸­æ›´æ–°codes.jsonæ–‡ä»¶</p>
            </div>
        </div>

        <h1 class="text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 text-center">SCL-90 å…‘æ¢ç ç®¡ç†å·¥å…· (çº¿ä¸Šç‰ˆ)</h1>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
            <!-- ç”Ÿæˆå…‘æ¢ç  -->
            <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-semibold mb-4">æ‰¹é‡ç”Ÿæˆå…‘æ¢ç </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">æ•°é‡</label>
                        <input
                            type="number"
                            id="generateCount"
                            class="w-full p-2 border rounded"
                            value="10"
                            min="1"
                            max="100"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">å‰ç¼€</label>
                        <input
                            type="text"
                            id="generatePrefix"
                            class="w-full p-2 border rounded"
                            value="SCL"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">æ‰¹æ¬¡</label>
                        <input
                            type="text"
                            id="batchName"
                            class="w-full p-2 border rounded"
                            value="batch2024"
                        />
                    </div>
                    <button
                        onclick="generateCodes()"
                        class="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 transition-colors"
                    >
                        ç”Ÿæˆå…‘æ¢ç 
                    </button>
                </div>
            </div>

            <!-- æ‰‹åŠ¨æ·»åŠ å…‘æ¢ç  -->
            <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-semibold mb-4">æ‰‹åŠ¨æ·»åŠ å…‘æ¢ç </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">å…‘æ¢ç ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea
                            id="newCodes"
                            class="w-full p-2 border rounded h-24 sm:h-32"
                            placeholder="LVOE123&#10;TEST456&#10;SCL789"
                        ></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">æ‰¹æ¬¡</label>
                        <input
                            type="text"
                            id="manualBatchName"
                            class="w-full p-2 border rounded"
                            value="manual"
                        />
                    </div>
                    <button
                        onclick="addManualCodes()"
                        class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition-colors"
                    >
                        æ·»åŠ åˆ°åˆ—è¡¨
                    </button>
                </div>
            </div>
        </div>

        <!-- å½“å‰å…‘æ¢ç åˆ—è¡¨ -->
        <div class="mt-6 sm:mt-8 bg-white rounded-lg shadow-lg p-4 sm:p-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4">
                <h2 class="text-lg sm:text-xl font-semibold">å½“å‰å…‘æ¢ç åˆ—è¡¨</h2>
                <div class="flex gap-2">
                    <button
                        onclick="loadCurrentCodes()"
                        class="bg-purple-500 text-white py-2 px-4 rounded hover:bg-purple-600 transition-colors"
                    >
                        ä»GitHubåŠ è½½
                    </button>
                    <button
                        onclick="clearAllCodes()"
                        class="bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600 transition-colors"
                    >
                        æ¸…ç©ºåˆ—è¡¨
                    </button>
                </div>
            </div>
            <div class="mb-4 text-sm text-gray-600">
                æ€»è®¡ï¼š<span id="totalCodes" class="font-semibold">0</span> ä¸ªå…‘æ¢ç  |
                å¯ç”¨ï¼š<span id="availableCodes" class="font-semibold text-green-600">0</span> ä¸ª |
                å·²ç”¨ï¼š<span id="usedCodes" class="font-semibold text-red-600">0</span> ä¸ª
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-2 sm:px-4 py-2 text-left">å…‘æ¢ç </th>
                            <th class="px-2 sm:px-4 py-2 text-left">çŠ¶æ€</th>
                            <th class="px-2 sm:px-4 py-2 text-left">æ‰¹æ¬¡</th>
                            <th class="px-2 sm:px-4 py-2 text-left hidden sm:table-cell">åˆ›å»ºæ—¶é—´</th>
                            <th class="px-2 sm:px-4 py-2 text-left">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="codesTable">
                        <tr>
                            <td colspan="5" class="text-center py-4 text-gray-500">
                                ç‚¹å‡»"ä»GitHubåŠ è½½"æˆ–ç”Ÿæˆæ–°å…‘æ¢ç 
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ç”Ÿæˆæ›´æ–°ä»£ç  -->
        <div class="mt-6 sm:mt-8 bg-white rounded-lg shadow-lg p-4 sm:p-6">
            <h2 class="text-lg sm:text-xl font-semibold mb-4">ç”ŸæˆGitHubæ›´æ–°ä»£ç </h2>
            <div class="mb-4">
                <div class="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4">
                    <p class="text-yellow-800 text-sm">
                        <strong>æ“ä½œæ­¥éª¤ï¼š</strong><br>
                        1. ç‚¹å‡»"ç”ŸæˆJSONä»£ç "<br>
                        2. å¤åˆ¶ç”Ÿæˆçš„JSONå†…å®¹<br>
                        3. åœ¨GitHubä»“åº“ä¸­ç¼–è¾‘codes.jsonæ–‡ä»¶<br>
                        4. ç²˜è´´æ–°å†…å®¹å¹¶æäº¤æ›´æ”¹
                    </p>
                </div>
                <button
                    onclick="generateUpdateCode()"
                    class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition-colors mb-3"
                >
                    ç”ŸæˆJSONä»£ç 
                </button>
                <div id="updateCodeSection" class="hidden">
                    <p class="text-sm text-gray-600 mb-2">å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼Œæ›´æ–°GitHubä»“åº“ä¸­çš„codes.jsonæ–‡ä»¶ï¼š</p>
                    <textarea
                        id="generatedJson"
                        class="w-full h-48 sm:h-64 p-2 border rounded font-mono text-xs"
                        readonly
                    ></textarea>
                    <div class="mt-3 flex gap-2">
                        <button
                            onclick="copyToClipboard()"
                            class="bg-blue-500 text-white py-1 px-3 rounded text-sm hover:bg-blue-600 transition-colors"
                        >
                            å¤åˆ¶åˆ°å‰ªè´´æ¿
                        </button>
                        <button
                            onclick="downloadJsonFile()"
                            class="bg-green-500 text-white py-1 px-3 rounded text-sm hover:bg-green-600 transition-colors"
                        >
                            ä¸‹è½½JSONæ–‡ä»¶
                        </button>
                        <span class="ml-2 text-sm text-green-600" id="copySuccess" style="display:none;">å·²å¤åˆ¶ï¼</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»“æœæ˜¾ç¤º -->
        <div id="result" class="mt-6 p-4 border rounded-lg hidden">
            <h3 class="font-semibold mb-2">æ“ä½œç»“æœï¼š</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // å½“å‰å…‘æ¢ç åˆ—è¡¨ï¼ˆåœ¨å†…å­˜ä¸­ï¼‰
        let currentCodes = [];
        let loadedCodes = [];

        // ç”Ÿæˆå”¯ä¸€å…‘æ¢ç 
        function generateUniqueCode(prefix, index) {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substring(2, 6);
            return `${prefix}${timestamp}${random}`.toUpperCase();
        }

        // ç”Ÿæˆå…‘æ¢ç 
        function generateCodes() {
            const count = parseInt(document.getElementById('generateCount').value);
            const prefix = document.getElementById('generatePrefix').value.toUpperCase();
            const batch = document.getElementById('batchName').value.trim();

            if (count < 1 || count > 100) {
                showResult('error', 'æ•°é‡å¿…é¡»åœ¨1-100ä¹‹é—´');
                return;
            }

            const codes = [];
            for (let i = 0; i < count; i++) {
                codes.push(generateUniqueCode(prefix, i));
            }

            // æ·»åŠ åˆ°å½“å‰åˆ—è¡¨
            const newCodes = codes.map(code => ({
                code: code,
                status: 'available',
                createdAt: new Date().toISOString(),
                batch: batch
            }));

            currentCodes = [...currentCodes, ...newCodes];
            displayCodes();
            showResult('success', `å·²ç”Ÿæˆ ${count} ä¸ªå…‘æ¢ç `);
        }

        // æ‰‹åŠ¨æ·»åŠ å…‘æ¢ç 
        function addManualCodes() {
            const codesText = document.getElementById('newCodes').value.trim();
            const batch = document.getElementById('manualBatchName').value.trim();

            if (!codesText) {
                showResult('error', 'è¯·è¾“å…¥å…‘æ¢ç ');
                return;
            }

            const codes = codesText.split('\n')
                .map(code => code.trim().toUpperCase())
                .filter(code => code.length > 0);

            if (codes.length === 0) {
                showResult('error', 'æ²¡æœ‰æœ‰æ•ˆçš„å…‘æ¢ç ');
                return;
            }

            // æ£€æŸ¥é‡å¤
            const duplicates = codes.filter(code =>
                currentCodes.some(existing => existing.code === code) ||
                loadedCodes.some(existing => existing.code === code)
            );

            if (duplicates.length > 0) {
                showResult('error', `ä»¥ä¸‹å…‘æ¢ç å·²å­˜åœ¨ï¼š${duplicates.join(', ')}`);
                return;
            }

            // æ·»åŠ åˆ°å½“å‰åˆ—è¡¨
            const newCodes = codes.map(code => ({
                code: code,
                status: 'available',
                createdAt: new Date().toISOString(),
                batch: batch
            }));

            currentCodes = [...currentCodes, ...newCodes];
            displayCodes();
            showResult('success', `æˆåŠŸæ·»åŠ  ${codes.length} ä¸ªå…‘æ¢ç `);
            document.getElementById('newCodes').value = '';
        }

        // ä»GitHubåŠ è½½å½“å‰å…‘æ¢ç 
        async function loadCurrentCodes() {
            try {
                const response = await fetch('./codes.json?' + Date.now());
                if (!response.ok) {
                    throw new Error('æ— æ³•åŠ è½½GitHubä¸Šçš„codes.jsonæ–‡ä»¶');
                }

                const data = await response.json();
                loadedCodes = data.codes || [];
                currentCodes = [...loadedCodes];
                displayCodes();
                showResult('success', `å·²ä»GitHubåŠ è½½ ${loadedCodes.length} ä¸ªå…‘æ¢ç `);
            } catch (error) {
                showResult('error', `åŠ è½½å¤±è´¥ï¼š${error.message}`);
            }
        }

        // æ˜¾ç¤ºå…‘æ¢ç è¡¨æ ¼
        function displayCodes() {
            const table = document.getElementById('codesTable');
            const allCodes = [...loadedCodes, ...currentCodes];

            // ç»Ÿè®¡ä¿¡æ¯
            const totalCount = allCodes.length;
            const availableCount = allCodes.filter(c => c.status === 'available').length;
            const usedCount = allCodes.filter(c => c.status === 'used').length;

            document.getElementById('totalCodes').textContent = totalCount;
            document.getElementById('availableCodes').textContent = availableCount;
            document.getElementById('usedCodes').textContent = usedCount;

            if (allCodes.length > 0) {
                table.innerHTML = allCodes.map((code, index) => `
                    <tr class="border-b">
                        <td class="px-2 sm:px-4 py-2 font-mono text-xs sm:text-sm">${code.code}</td>
                        <td class="px-2 sm:px-4 py-2">
                            <span class="px-2 py-1 rounded text-xs ${
                                code.status === 'available'
                                    ? 'bg-green-100 text-green-700'
                                    : 'bg-red-100 text-red-700'
                            }">
                                ${code.status === 'available' ? 'å¯ç”¨' : 'å·²ç”¨'}
                            </span>
                        </td>
                        <td class="px-2 sm:px-4 py-2 text-xs sm:text-sm">${code.batch}</td>
                        <td class="px-2 sm:px-4 py-2 text-xs sm:text-sm hidden sm:table-cell">
                            ${new Date(code.createdAt).toLocaleDateString()}
                        </td>
                        <td class="px-2 sm:px-4 py-2">
                            <button
                                onclick="removeCode(${index})"
                                class="text-red-500 hover:text-red-700 text-xs sm:text-sm"
                            >
                                åˆ é™¤
                            </button>
                        </td>
                    </tr>
                `).join('');
            } else {
                table.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">æš‚æ— å…‘æ¢ç </td></tr>';
            }
        }

        // åˆ é™¤å…‘æ¢ç 
        function removeCode(index) {
            const allCodes = [...loadedCodes, ...currentCodes];
            const removedCode = allCodes[index];

            // ä»currentCodesä¸­ç§»é™¤ï¼ˆå¦‚æœæ˜¯æ–°æ·»åŠ çš„ï¼‰
            currentCodes = currentCodes.filter(c => c.code !== removedCode.code);

            displayCodes();
            showResult('success', `å·²åˆ é™¤å…‘æ¢ç ï¼š${removedCode.code}`);
        }

        // æ¸…ç©ºæ‰€æœ‰å…‘æ¢ç 
        function clearAllCodes() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å…‘æ¢ç å—ï¼Ÿè¿™å°†åªä¿ç•™GitHubä¸­å·²å­˜åœ¨çš„å…‘æ¢ç ã€‚')) {
                currentCodes = [];
                displayCodes();
                showResult('success', 'å·²æ¸…ç©ºæœ¬åœ°å…‘æ¢ç åˆ—è¡¨');
            }
        }

        // ç”Ÿæˆæ›´æ–°ä»£ç 
        function generateUpdateCode() {
            const allCodes = [...loadedCodes, ...currentCodes];

            const updateData = {
                codes: allCodes,
                lastUpdated: new Date().toISOString(),
                version: "1.0"
            };

            const jsonContent = JSON.stringify(updateData, null, 2);
            document.getElementById('generatedJson').value = jsonContent;
            document.getElementById('updateCodeSection').classList.remove('hidden');

            showResult('success', 'JSONä»£ç å·²ç”Ÿæˆï¼Œè¯·å¤åˆ¶åˆ°GitHubä»“åº“ä¸­');
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            const textarea = document.getElementById('generatedJson');
            textarea.select();
            document.execCommand('copy');

            const successMsg = document.getElementById('copySuccess');
            successMsg.style.display = 'block';

            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        // ä¸‹è½½JSONæ–‡ä»¶
        function downloadJsonFile() {
            const textarea = document.getElementById('generatedJson');
            const blob = new Blob([textarea.value], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'codes.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showResult('success', 'JSONæ–‡ä»¶å·²ä¸‹è½½');
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(type, message) {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');

            resultDiv.classList.remove('hidden');
            resultContent.innerHTML = `
                <div class="p-3 rounded ${
                    type === 'success'
                        ? 'bg-green-100 text-green-700'
                        : 'bg-red-100 text-red-700'
                }">
                    ${message}
                </div>
            `;

            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                resultDiv.classList.add('hidden');
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½
        window.addEventListener('load', () => {
            loadCurrentCodes();
        });
    </script>
</body>
</html>