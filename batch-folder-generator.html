<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡æ–‡ä»¶å¤¹ç”Ÿæˆå·¥å…·</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        .upload-section {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .upload-section:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .upload-section.dragover {
            border-color: #667eea;
            background: #e8f2ff;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }
        
        .file-input-button:hover {
            transform: translateY(-2px);
        }
        
        .path-section {
            margin: 20px 0;
        }
        
        .path-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 10px;
            box-sizing: border-box;
        }
        
        .path-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .preview-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        
        .folder-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background: white;
            padding: 10px;
        }
        
        .folder-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: #e9ecef;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
        
        .folder-item::before {
            content: "ğŸ“";
            margin-right: 10px;
        }
        
        .generate-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            transition: transform 0.2s;
            margin-top: 20px;
        }
        
        .generate-button:hover {
            transform: translateY(-2px);
        }
        
        .generate-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .log-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .log-content {
            background: #343a40;
            color: #ffffff;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .instructions {
            background: #e8f4f8;
            border-left: 4px solid #17a2b8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .instructions h3 {
            color: #0c5460;
            margin-top: 0;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æ‰¹é‡æ–‡ä»¶å¤¹ç”Ÿæˆå·¥å…·</h1>
        
        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ol>
                <li>å‡†å¤‡ä¸€ä¸ªExcelæ–‡ä»¶ï¼Œåœ¨ç¬¬ä¸€åˆ—ï¼ˆAåˆ—ï¼‰è¾“å…¥è¦åˆ›å»ºçš„æ–‡ä»¶å¤¹åç§°</li>
                <li>ç‚¹å‡»"é€‰æ‹©Excelæ–‡ä»¶"æŒ‰é’®æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ</li>
                <li>ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶å¤¹"æŒ‰é’®ï¼Œé€‰æ‹©è¦åˆ›å»ºæ–‡ä»¶å¤¹çš„ç›®æ ‡ä½ç½®</li>
                <li>é¢„è§ˆæ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»"ç”Ÿæˆæ–‡ä»¶å¤¹"</li>
            </ol>
        </div>
        
        <div class="upload-section" id="uploadSection">
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" />
                <button class="file-input-button">é€‰æ‹©Excelæ–‡ä»¶</button>
            </div>
            <p style="margin-top: 15px; color: #666;">æ”¯æŒ .xlsx å’Œ .xls æ ¼å¼ï¼Œæˆ–ç›´æ¥æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸ</p>
        </div>
        
        <div class="path-section">
            <label for="pathSelector"><strong>æ–‡ä»¶å¤¹åˆ›å»ºè·¯å¾„ï¼š</strong></label>
            <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                <div class="file-input-wrapper">
                    <input type="file" id="folderInput" class="file-input" webkitdirectory directory multiple />
                    <button class="file-input-button">é€‰æ‹©æ–‡ä»¶å¤¹</button>
                </div>
            </div>
            <p style="color: #666; margin-top: 5px;" id="pathDescription">è¯·é€‰æ‹©æ–‡ä»¶å¤¹åˆ›å»ºè·¯å¾„</p>
        </div>
        
        <div class="preview-section" id="previewSection">
            <h3>ğŸ“‹ æ–‡ä»¶å¤¹é¢„è§ˆ (<span id="folderCount">0</span> ä¸ªæ–‡ä»¶å¤¹)</h3>
            <div class="folder-list" id="folderList"></div>
        </div>
        
        <button class="generate-button" id="generateButton" disabled>ç”Ÿæˆæ–‡ä»¶å¤¹</button>
        
        <div class="log-section" id="logSection">
            <h3>ğŸ“ ç”Ÿæˆæ—¥å¿—</h3>
            <div class="log-content" id="logContent"></div>
        </div>
    </div>

    <script>
        let folderNames = [];
        
        const fileInput = document.getElementById('fileInput');
        const uploadSection = document.getElementById('uploadSection');
        const previewSection = document.getElementById('previewSection');
        const folderList = document.getElementById('folderList');
        const folderCount = document.getElementById('folderCount');
        const generateButton = document.getElementById('generateButton');
        const logSection = document.getElementById('logSection');
        const logContent = document.getElementById('logContent');
        const pathDescription = document.getElementById('pathDescription');
        const folderInput = document.getElementById('folderInput');
        
        let selectedFolderPath = '';
        
        // æ–‡ä»¶å¤¹é€‰æ‹©äº‹ä»¶
        folderInput.addEventListener('change', handleFolderSelect);
        
        function handleFolderSelect(event) {
            const files = event.target.files;
            if (files.length > 0) {
                // è·å–é€‰ä¸­æ–‡ä»¶å¤¹çš„è·¯å¾„
                const file = files[0];
                const path = file.webkitRelativePath;
                const folderName = path.split('/')[0];
                
                // ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•è·å–å®Œæ•´çš„ç³»ç»Ÿè·¯å¾„
                // ä½†æˆ‘ä»¬å¯ä»¥è·å–æ–‡ä»¶å¤¹åç§°
                selectedFolderPath = folderName;
                pathDescription.textContent = `å·²é€‰æ‹©æ–‡ä»¶å¤¹: ${folderName}`;
                pathDescription.style.color = '#28a745';
                
                // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                showMessage('æ–‡ä»¶å¤¹å·²é€‰æ‹©ï¼Œç”Ÿæˆçš„è„šæœ¬å°†åœ¨è¯¥æ–‡ä»¶å¤¹å†…åˆ›å»ºå­æ–‡ä»¶å¤¹', 'success');
            }
        }
        
        function getSelectedPath() {
            if (selectedFolderPath) {
                return `%CD%\\${selectedFolderPath}`;
            }
            return '%USERPROFILE%\\Desktop';
        }
        
        function getPowerShellPath() {
            if (selectedFolderPath) {
                return `$PWD\\${selectedFolderPath}`;
            }
            return '$env:USERPROFILE\\Desktop';
        }
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', handleFileSelect);
        
        // æ‹–æ‹½äº‹ä»¶
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });
        
        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });
        
        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        // ç”ŸæˆæŒ‰é’®äº‹ä»¶
        generateButton.addEventListener('click', generateFolders);
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        function handleFile(file) {
            if (!file.name.match(/\.(xlsx|xls)$/)) {
                showMessage('è¯·é€‰æ‹©Excelæ–‡ä»¶ï¼ˆ.xlsx æˆ– .xls æ ¼å¼ï¼‰', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    // æå–ç¬¬ä¸€åˆ—çš„æ–‡ä»¶å¤¹åç§°
                    folderNames = jsonData
                        .map(row => row[0])
                        .filter(name => name && typeof name === 'string' && name.trim() !== '')
                        .map(name => name.trim());
                    
                    if (folderNames.length === 0) {
                        showMessage('Excelæ–‡ä»¶ç¬¬ä¸€åˆ—æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ–‡ä»¶å¤¹åç§°', 'error');
                        return;
                    }
                    
                    // å»é‡
                    folderNames = [...new Set(folderNames)];
                    
                    displayPreview();
                    showMessage(`æˆåŠŸè¯»å– ${folderNames.length} ä¸ªæ–‡ä»¶å¤¹åç§°`, 'success');
                    
                } catch (error) {
                    showMessage('è¯»å–Excelæ–‡ä»¶å¤±è´¥ï¼š' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function displayPreview() {
            folderList.innerHTML = '';
            folderNames.forEach(name => {
                const div = document.createElement('div');
                div.className = 'folder-item';
                div.textContent = name;
                folderList.appendChild(div);
            });
            
            folderCount.textContent = folderNames.length;
            previewSection.style.display = 'block';
            generateButton.disabled = false;
        }
        
        function generateFolders() {
            if (folderNames.length === 0) {
                showMessage('è¯·å…ˆé€‰æ‹©Excelæ–‡ä»¶', 'error');
                return;
            }
            
            // åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥åˆ›å»ºæ–‡ä»¶å¤¹
            // è¿™é‡Œæä¾›æ‰¹å¤„ç†è„šæœ¬å’ŒPowerShellè„šæœ¬
            generateBatchScript();
            generatePowerShellScript();
            
            showMessage('å·²ç”Ÿæˆæ‰¹å¤„ç†è„šæœ¬å’ŒPowerShellè„šæœ¬ï¼Œè¯·ä¸‹è½½ååœ¨ç”µè„‘ä¸Šè¿è¡Œ', 'success');
        }
        
        function generateBatchScript() {
            const basePath = getSelectedPath();
            let script = `@echo off\nchcp 65001 > nul\necho å¼€å§‹åˆ›å»ºæ–‡ä»¶å¤¹...\necho ç›®æ ‡è·¯å¾„: ${basePath}\necho.\n\n`;
            
            folderNames.forEach(name => {
                const safeName = name.replace(/"/g, '""');
                script += `mkdir "${basePath}\\${safeName}" 2>nul\n`;
                script += `if exist "${basePath}\\${safeName}" (\n`;
                script += `    echo âœ“ æˆåŠŸåˆ›å»º: ${safeName}\n`;
                script += `) else (\n`;
                script += `    echo âœ— åˆ›å»ºå¤±è´¥: ${safeName}\n`;
                script += `)\n\n`;
            });
            
            script += `echo.\necho æ–‡ä»¶å¤¹åˆ›å»ºå®Œæˆï¼\npause\n`;
            
            downloadFile('create_folders.bat', script);
        }
        
        function generatePowerShellScript() {
            const basePath = getPowerShellPath();
            let script = `# PowerShellè„šæœ¬ - æ‰¹é‡åˆ›å»ºæ–‡ä»¶å¤¹\n`;
            script += `Write-Host "å¼€å§‹åˆ›å»ºæ–‡ä»¶å¤¹..." -ForegroundColor Green\n`;
            script += `Write-Host "ç›®æ ‡è·¯å¾„: ${basePath}" -ForegroundColor Yellow\n`;
            script += `Write-Host ""\n\n`;
            
            folderNames.forEach(name => {
                script += `try {\n`;
                script += `    New-Item -ItemType Directory -Path "${basePath}\\${name}" -Force | Out-Null\n`;
                script += `    Write-Host "âœ“ æˆåŠŸåˆ›å»º: ${name}" -ForegroundColor Green\n`;
                script += `} catch {\n`;
                script += `    Write-Host "âœ— åˆ›å»ºå¤±è´¥: ${name} - $_" -ForegroundColor Red\n`;
                script += `}\n\n`;
            });
            
            script += `Write-Host ""\nWrite-Host "æ–‡ä»¶å¤¹åˆ›å»ºå®Œæˆï¼" -ForegroundColor Green\n`;
            script += `Read-Host "æŒ‰å›è½¦é”®é€€å‡º"\n`;
            
            downloadFile('create_folders.ps1', script);
        }
        
        function downloadFile(filename, content) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function showMessage(message, type) {
            // ç§»é™¤ç°æœ‰æ¶ˆæ¯
            const existingMessages = document.querySelectorAll('.warning, .success, .error');
            existingMessages.forEach(msg => msg.remove());
            
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(div, generateButton);
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                if (div.parentNode) {
                    div.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
