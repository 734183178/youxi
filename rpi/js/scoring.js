// ============================================
// 修复版 scoring.js - 完整版
// ============================================

/**
 * 获取最新测试结果
 */
function getLatestResult() {
    try {
        return JSON.parse(localStorage.getItem('latestRpiResult') || 'null');
    } catch (error) {
        console.error('读取最新结果失败:', error);
        return null;
    }
}

/**
 * 扩展的RPI等级描述库 - 娱乐轻松版
 */
const enhancedRPIAnalysis = {
    // ==========================================
    // Level 1: 完美健康 (RPI 0-20)
    // ==========================================
    1: [
        {
            meaning: "你的恋爱状态简直是'松弛感'的代名词。你给伴侣的信任度大概有太平洋那么宽。在你看来，谈恋爱是找个队友一起打怪升级，而不是找个犯人天天审讯。这种自信和从容，真的很迷人。",
            suggestion: "你的心态很完美，继续保持！不过偶尔也可以'假装'吃点小醋，或者撒个娇查个岗（虽然你根本不想查）。适度的'作'一下，能让对方感觉到你是在乎TA的，不然TA可能会以为你把TA当兄弟了。",
            tone: "凡尔赛型"
        },
        {
            meaning: "你是典型的'放养系'恋人。你就像手握风筝线的人，只要线不断，风筝飞得再高你也懒得管。朋友们可能觉得你心太大，但只有你明白，这种松弛感才是长久关系的秘诀。",
            suggestion: "你的独立性很强，这是你的魅力所在。但要注意，别让这种独立变成'冷漠'的错觉。偶尔主动制造一点粘人的时刻，比如求抱抱、求安慰，会让恋爱体验更甜哦。",
            tone: "潇洒型"
        },
        {
            meaning: "你拥有令人羡慕的'大心脏'。伴侣不回消息？你觉得TA肯定在忙，而不是在搞鬼。伴侣有异性朋友？你觉得正常社交嘛，谁还没个朋友。这种强大的安全感，让你在恋爱里很少内耗。",
            suggestion: "既然你这么省心，不如把省下来的精力用在提升恋爱质量上。多策划几次有趣的约会，或者给对方准备个小惊喜。毕竟，太安全的恋爱有时候容易变得平淡，需要你加点调料。",
            tone: "从容型"
        },
        {
            meaning: "在你眼里，爱情最好的状态是'你是你，我是我，我们在一起很开心'。你不喜欢粘粘糊糊的戏码，更讨厌互相猜忌的剧本。你给了对方最大的自由，也保留了最完整的自己。",
            suggestion: "别忘了，恋爱有时候也需要一点'不理性'。下次见面时，试着哪怕只有一分钟，完全放下理智，像个热恋期的傻瓜一样粘着对方，你会发现不一样的乐趣。",
            tone: "理智型"
        },
    ],
    
    // ==========================================
    // Level 2: 良好平衡 (RPI 36-50)
    // ==========================================
    2: [
        {
            meaning: "你找到了恋爱中最舒服的状态——在乎，但不过分；关心，但不控制。你会因为伴侣的某些行为吃醋，但能理性地处理这种情绪；你希望了解TA的生活，但不会事无巨细地追问。这种'恰到好处'的爱，让你们既有亲密感，又不会互相窒息。",
            suggestion: "你已经在健康关系的正确轨道上了。继续保持这种平衡感，学会在感到不安时用成熟的方式沟通，而不是压抑或爆发。记住：小醋怡情，大醋伤身。",
            tone: "鼓励型"
        },
        {
            meaning: "你的占有欲就像调味的盐——适量就是完美。你不是那种'佛系到冷漠'的人，也不是'爱到窒息'的类型。看到TA和异性聊天会在意，但不会歇斯底里；想知道TA在哪里，但不会GPS定位跟踪。这个度，刚刚好。",
            suggestion: "保持现状就很好。偶尔觉得不安时，试着先问问自己：'我是真的发现了问题，还是在自己吓自己？'大多数时候，你会发现是后者。深呼吸，然后该干嘛干嘛。",
            tone: "朋友式"
        },
        {
            meaning: "你是一个很真实的恋人。你有七情六欲，会有小嫉妒和小脾气，但这正是你可爱的地方。你没有被占有欲冲昏头脑，当理智回归时，你总能做出尊重的选择。你的伴侣会觉得你既在乎TA，又很讲道理。",
            suggestion: "当你吃醋的时候，不妨直接撒个娇说'我吃醋了'，而不是生闷气。这种坦率的表达往往比冷战更有效，也能让吃醋变成情趣。",
            tone: "生活化型"
        },
        {
            meaning: "你的RPI指数显示你处于'黄金分割点'。你有警觉性，这能保护关系免受外界干扰；但你没有攻击性，这能保护伴侣免受内部压力。你懂得在原则问题上坚定，在小事上糊涂。",
            suggestion: "继续修炼这种智慧。当遇到让你们产生分歧的事情时，多换位思考。你的平衡能力是你维护长期关系的最大优势。",
            tone: "分析型"
        },
    ],
    
    // ==========================================
    // Level 3: 中等偏高 (RPI 51-70)
    // ==========================================
    3: [
        {
            meaning: "你的占有欲指数在中等偏高水平，这意味着你正站在一个十字路口：往左是健康的关心，往右是过度的控制。现在的你，对伴侣的行为比较敏感，会希望掌握TA的动态。虽然还没到让对方窒息的程度，但某些时刻，TA可能已经感受到了压力。",
            suggestion: "这是一个需要注意的临界点。如果不加注意，你的'在乎'可能会慢慢变成'监控'。建议从现在开始培养自己的兴趣爱好，建立独立的社交圈。记住：你越充实，就越不会把全部注意力放在伴侣身上。",
            tone: "提醒型"
        },
        {
            meaning: "说实话，你有点太在意伴侣了。TA的一条朋友圈、一个点赞、一次晚归，都能让你心里泛起波澜。你不是不信任TA，而是太害怕失去TA。这种焦虑感，正在一点点影响你们的相处质量。",
            suggestion: "停下来，深呼吸。问问自己：我到底在怕什么？是怕TA变心，还是怕自己不够好？找到恐惧的根源，才能真正解决问题。也许你需要的不是一个'更老实'的伴侣，而是一个更强大的自己。",
            tone: "直接型"
        },
        {
            meaning: "你处在占有欲的'灰色地带'——还没糟糕到关系破裂，但已经开始影响你们的日常相处。伴侣可能觉得和你在一起有点累，需要时刻注意你的情绪；而你也累，总是在担心、怀疑、不安中度过。",
            suggestion: "是时候做出改变了。这种焦虑感会榨干你的能量，让你变成一个连自己都不喜欢的人。从小事做起：今天不看TA的朋友圈、这周末不问TA的行踪，试试看，其实天也不会塌下来。",
            tone: "共情型"
        },
        {
            meaning: "你的内心可能住着一个'缺乏安全感的小孩'。当伴侣不在视线范围内时，这个小孩就开始哭闹，让你想要抓紧对方。这并不是因为你强势，恰恰是因为你内心柔软且脆弱。",
            suggestion: "试着安抚内心的那个小孩，而不是通过控制伴侣来止痛。告诉自己：'我是值得被爱的，即使TA现在不在我身边。' 这种自我安抚的能力，是你成长的必修课。",
            tone: "心理疗愈型"
        },
        {
            meaning: "你正在玩一个危险的游戏：你试图通过收紧手中的沙子来留住它。但常识告诉我们，握得越紧，沙子流失得越快。你频繁的确认和查岗，可能正在把伴侣推开。",
            suggestion: "试着松开手。信任就像肌肉，是需要锻炼的。下一次你想查岗的时候，强迫自己忍住，去做点别的事。每一次忍耐，都是在锻炼你的'信任肌肉'。",
            tone: "比喻警示型"
        }
    ],
    
    // ==========================================
    // Level 4: 偏高水平 (RPI 71-85)
    // ==========================================
    4: [
        {
            meaning: "你的占有欲已经到了需要认真重视的程度。你可能经常查看伴侣的手机、追问TA的行踪，甚至会因为一些小事大发脾气。你告诉自己'这是因为我太爱TA'，但这种高压的相处模式，正在让你们的感情迅速内耗。",
            suggestion: "这是一个严肃的提醒：如果不立即做出改变，你们的相处模式会变得越来越累。试着给彼此更多的自由，把关注点重新放回自己身上。当你再次变得闪闪发光时，你们的关系也会更轻松、更美好。",
            tone: "严肃提醒型"
        },
        {
            meaning: "让我们诚实一点：你正在用'爱'的名义，做着消耗感情的事。监控手机、过度追问...这些行为，正在一点点消耗伴侣对你的耐心。你可能觉得'如果TA真的爱我，就应该理解我'，但换位思考一下：如果有人这样对你，你能承受多久？",
            suggestion: "是时候面对现实了。你需要的不是一个'更听话'的伴侣，而是把精力从监视转移到自我建设上。为你自己，认真对待并改变这个相处模式，因为这份焦虑感主要在折磨你自己。",
            tone: "直白内省型"
        },
        {
            meaning: "我能感受到你内心的恐惧和不安。你这么做，不是因为你坏，而是因为你太害怕了——害怕被忽视、害怕不够好。你试图通过控制伴侣来获得安全感。但讽刺的是，你越抓越紧，双方的相处就越沉重。",
            suggestion: "你值得被爱，也值得拥有健康的关系。但首先，你需要学会爱自己、相信自己。真正的安全感，只能来自你的内心强大，而不是伴侣的手机密码或行踪报告。",
            tone: "温柔理解型"
        },
        {
            meaning: "你的关系模式已经亮起了红灯。你把自己变成了这段关系的'警察'，而伴侣变成了'嫌疑人'。每一天都像是在审讯和辩解中度过，这种高压环境会让爱情的甜度迅速下降。",
            suggestion: "卸下你的警徽吧。爱情不是执法，不需要寻找证据。尝试给对方哪怕一天的完全信任，看看会发生什么。你会发现，信任带来的轻松感，远比怀疑带来的痛苦要值得。",
            tone: "角色隐喻型"
        },
        {
            meaning: "你的RPI分数显示你很渴望亲密，但又恐惧被伤害。这种矛盾让你反复无常：一会儿对TA极好，一会儿又情绪爆发。这对伴侣来说是一种巨大的情感考验。",
            suggestion: "请多了解一些相处技巧。当情绪上头时，给自己设置一个 '10分钟冷静期'，等平静后再沟通。用理智来管理情绪，而不是让情绪来主导关系。",
            tone: "技巧指导型"
        }
    ],
    
    // ==========================================
    // Level 5: 很高水平 (RPI 86-100) - 已软化处理
    // ==========================================
    5: [
        {
            meaning: "你是一个'为爱痴狂'的人，很容易被这段关系完全占据。你可能将大部分的快乐和精力都投入到了伴侣身上，导致自己很容易陷入情绪的漩涡。你的爱很深，但表达方式可能过于沉重，让彼此都感到透不过气。",
            suggestion: "现在是时候按下'个人生活重启键'了。把对伴侣 80% 的关注度，分 40% 给自己。挑战自己去尝试一项全新的运动或兴趣爱好，你很快会发现：当你更爱自己时，你的吸引力也会成倍增加。",
            tone: "温柔聚焦自我型"
        },
        {
            meaning: "你的世界里，这段关系占的比重太大了，导致你个人的光芒都有点被遮盖了。一旦伴侣不在身边，你可能就会感到强烈的空虚和不安。这种状态，消耗的是你自己，也让原本轻松的爱情变得辛苦。",
            suggestion: "请给自己放个长假，从'爱情岗位'上短暂休息一下。给自己制定一个'快乐清单'，上面只写能让你一个人感到快乐的事情。记住，你最初吸引TA的，就是你独立发光的样子。",
            tone: "恢复魅力型"
        },
        {
            meaning: "我必须告诉你一个秘密：你现在最累的人是你自己。你把太多时间花在担心、猜测和确认上，这份焦虑感正在榨干你的能量。这种沉重的相处模式，会让你和伴侣都失去恋爱的乐趣。",
            suggestion: "我们来玩个小游戏：给自己设定一个'信任周'挑战。在一周内，强制自己对伴侣的行踪和社交采取'选择性失明'，把节省下来的精力用来和朋友大笑一场，或者学习一项新技能。你会发现，生活远比你想象的更精彩。",
            tone: "轻松挑战型"
        },
        {
            meaning: "你的爱像一张密不透风的网，虽然是为了保护关系，但却让网中的人失去了呼吸的空间。你可能在无意识中，让伴侣感觉到了强烈的束缚感。爱是希望彼此都自由，而不是互相被困住。",
            suggestion: "请给你们的关系'通通风'。可以和伴侣坦诚聊聊（语气要轻松哦）：'我发现我最近有点太粘人了，我打算给你多一点自由，也给我自己多一点空间。' 主动做出调整，会让伴侣看到你愿意为这段关系变得更好的努力。",
            tone: "关系通气型"
        },
        {
            meaning: "你可能在不知不觉中，把所有的鸡蛋都放在了'爱情'这一个篮子里。一旦这个篮子有点晃动，你就会感到世界末日。你需要的是多几个坚固的'篮子'，比如友谊、事业、个人成就。",
            suggestion: "为了你自己的幸福感，现在必须重新平衡你的生活。立即拿起你曾经放下的兴趣，或者去结识一些新的朋友。只有当你重新成为一个丰盛的个体时，你的爱情才会变得轻松、有趣、且坚不可摧。",
            tone: "自我增值型"
        }
    ]
};

/**
 * 维度组合的深度分析库
 */
const dimensionCombinationLibrary = {
    tripleHigh: {
        title: "🚨 警戒：全面占有型人格",
        description: "你在控制、嫉妒、依赖三个维度都显示出高水平，这是最需要警惕的组合模式。你不仅想掌控伴侣的一切，还极度害怕失去TA，生活重心完全围绕这段关系。这种模式下，你和伴侣都承受着巨大的情感压力。",
        risks: [
            "伴侣可能感到严重的压力和束缚感",
            "你的身心健康正在被焦虑侵蚀，可能出现失眠、情绪波动等",
            "这种模式如果持续，会严重影响关系的长期发展"
        ],
        advice: "强烈建议寻求专业心理咨询帮助。这种组合模式往往有深层的心理原因，需要系统的心理疏导和自我成长。"
    },
    
    controlButIndependent: {
        title: "👑 矛盾：独立的控制者",
        description: "这是一个有趣的组合：你自己很独立，有自己的生活和社交，但却想控制伴侣的一切。你可能是个事业型的人，习惯了掌控局面，也想在感情中'说了算'。你不是离不开伴侣，但你要求伴侣离不开你。",
        rootCause: "这种模式通常源于：控制欲人格、完美主义倾向、或是过往恋爱中的'被伤害'经历让你决定'这次我要掌握主动权'。",
        advice: "认清一个事实：爱情不是权力游戏，不是谁更需要谁的比赛。真正平等的关系，是两个独立的人选择在一起，而不是一个人'允许'另一个人在身边。"
    },
    
    jealousButNotControlling: {
        title: "💔 痛苦：隐忍的焦虑者",
        description: "你内心嫉妒得要命，但表面装作不在乎；你想知道TA的一切，但不好意思直接问；你吃醋了也不敢说，只能自己默默难受。你害怕'太粘人会把TA吓跑'，所以选择压抑自己的真实感受。",
        consequences: "这种模式最大的问题是：伴侣可能完全不知道你的真实感受，等你终于爆发的时候，TA会觉得'莫名其妙'。而你的隐忍，也在慢慢消耗你对这段关系的信心。",
        advice: "学会健康地表达你的需求和不安。说'我有点在意'不丢人，真正需要注意的是装作不在意，然后在某一天突然崩溃。成熟的沟通是关系的基石。"
    },
    
    anxiousAttachment: {
        title: "😰 典型：焦虑型依恋人格",
        description: "你是教科书般的'焦虑型依恋'——生活重心完全是伴侣，同时又极度害怕被抛弃。你需要不断确认TA的爱，但无论TA怎么保证，你都无法真正安心。",
        psychologicalRoots: "焦虑型依恋通常源于：童年时父母的忽视或不稳定的陪伴、过往恋爱中的背叛经历、或是天生的高敏感性格。",
        healingPath: [
            "意识到：伴侣不是你的'救世主'，TA无法填补你内心的空洞",
            "建立自己的生活重心：工作、爱好、朋友、自我成长",
            "学习'自我安抚'：当焦虑来袭时，用正念呼吸、写日记等方式平复情绪",
            "考虑依恋理论相关的心理咨询，会很有帮助"
        ]
    },
    
    balanced: {
        title: "✨ 理想：成熟恋爱者",
        description: "恭喜你！你在四个维度上都保持着健康的水平。你既能给予伴侣自由，又能表达自己的需求；你会吃醋，但不会失控；你在乎这段关系，但也有自己的生活。",
        strengths: [
            "你懂得：爱是锦上添花，而不是救命稻草",
            "你相信：真正的亲密是选择，而不是控制",
            "你明白：关系需要两个完整的人，而不是两个半人"
        ],
        advice: "保持现状，同时也要注意：生活中的重大变故可能会暂时打破这种平衡。当压力来临时，记得回到这些原则：沟通、信任、独立、尊重。"
    },
    
    controlButNotJealous: {
        title: "🎯 特殊：理性控制者",
        description: "你的控制欲不是来自嫉妒或不安全感，而是来自'我觉得我的方式是对的'。你可能不在意伴侣和异性聊天，但你要求TA按你的计划生活。",
        warning: "伴侣可能不会因为'吃醋'而离开你，但会因为'累'而离开你。没有人想和一个'老板'谈恋爱，即使这个老板很爱TA。爱情需要平等，不是管理。"
    }
};

/**
 * 维度分析的深度解读 - 每个维度的细分
 */
const dimensionDeepAnalysis = {
    control: {
        veryLow: {
            score: "0-10",
            title: "完全放手型",
            description: "你几乎不会干预伴侣的任何决定和行为。你相信每个人都应该保持独立性，过度干涉会破坏关系的平等基础。",
            positives: ["伴侣感受到充分的尊重和自由", "关系建立在信任而非控制的基础上"],
            cautions: ["确保不是'冷漠'被误解为'尊重自由'", "适度表达关心，让伴侣知道你在乎TA"]
        },
        low: {
            score: "11-25",
            title: "尊重界限型",
            description: "你给予伴侣大部分的自主权，但在重要事情上会表达自己的想法。你懂得什么时候该放手，什么时候该参与。",
            positives: ["平衡得当，既有关心又不越界", "伴侣愿意主动和你商量事情"],
            cautions: ["继续保持这种分寸感", "压力大时注意不要突然变得想控制一切"]
        },
        medium: {
            score: "26-35",
            title: "适度参与型",
            description: "你希望参与伴侣生活的大部分决定，虽然会尊重TA的意见，但你的观点往往有更大影响力。",
            concerns: ["伴侣可能开始感到'做什么都要经过你同意'的压力", "你的'建议'可能被感受为'要求'"],
            improvement: ["问自己：这件事我必须参与吗？", "练习说'你自己决定就好，我支持你'"]
        },
        high: {
            score: "36-43",
            title: "强势主导型",
            description: "你对伴侣的生活有很强的控制欲，从日常安排到重要决策，你都想参与甚至主导。",
            redFlags: ["伴侣可能已经失去了很多自主权", "你们的关系更像'家长-孩子'而非'情侣'"],
            urgentChange: ["这已经是不健康的控制，需要立即改变", "建议寻求心理咨询，探索控制欲的根源"]
        },
        veryHigh: {
            score: "44-50",
            title: "全面控制型",
            description: "你试图掌控伴侣的一切。这已经不是爱，而是控制，需要认真反思和寻求帮助。",
            severity: "这是严重的问题，建议寻求专业心理咨询"
        }
    },
    
    jealousy: {
        veryLow: {
            score: "0-16",
            title: "完全信任型",
            description: "你很少嫉妒，相信伴侣的忠诚。TA和异性相处你也觉得很正常。",
            strength: "这是非常健康的状态，建立在坚实的信任基础上"
        },
        low: {
            score: "17-27",
            title: "偶尔吃醋型",
            description: "你会吃醋，但能理性控制。这种'小醋'反而增添了恋爱的趣味。",
            balance: "这是健康的嫉妒水平，说明你在乎但不偏执"
        },
        medium: {
            score: "28-38",
            title: "敏感多疑型",
            description: "你对伴侣和异性的互动比较敏感，会过度解读一些正常行为。",
            improvement: ["问问自己：我的嫉妒是基于事实还是臆想？", "学会区分'正常社交'和'暧昧行为'"]
        },
        high: {
            score: "39-47",
            title: "强烈嫉妒型",
            description: "你的嫉妒心很强，经常会因为伴侣和异性的正常接触而不安、生气。",
            rootCause: "强烈的嫉妒往往源于深层的不安全感"
        },
        veryHigh: {
            score: "48-55",
            title: "过度嫉妒型",
            description: "你的嫉妒已经到了需要重视的程度，建议寻求专业帮助。"
        }
    },
    
    dependency: {
        veryLow: {
            score: "0-16",
            title: "高度独立型",
            description: "你保持着很强的独立性，有自己的生活重心。伴侣是你生活的重要部分，但不是全部。",
            strength: "这种独立性让你们的关系更平等、更持久"
        },
        low: {
            score: "17-27",
            title: "适度依赖型",
            description: "你依赖伴侣的情感支持，但也能独立处理自己的生活。",
            ideal: "这是最健康的依赖程度"
        },
        medium: {
            score: "28-38",
            title: "明显依赖型",
            description: "你对伴侣有较强的依赖性，你的快乐很大程度上来自这段关系。",
            risks: ["一旦关系出现问题，你会很难承受", "伴侣可能感到'被需要得太多了'的压力"]
        },
        high: {
            score: "39-47",
            title: "过度依赖型",
            description: "你的生活重心完全是伴侣，没有TA你会感到迷失。",
            dangers: ["你失去了自我", "这种压力会让伴侣想逃离"]
        },
        veryHigh: {
            score: "48-55",
            title: "极度依赖型",
            description: "你完全无法离开伴侣，需要认真对待这个问题。"
        }
    },
    
    security: {
        veryHigh: {
            score: "0-15",
            title: "高度安全型",
            description: "你对这段关系充满信心，很少怀疑伴侣的感情。",
            foundation: "这种安全感是健康关系的基石"
        },
        high: {
            score: "16-25",
            title: "基本安全型",
            description: "你对关系比较有信心，虽然偶尔会担心，但大部分时候都能保持平静。",
            stability: "这是正常且健康的安全感水平"
        },
        medium: {
            score: "26-35",
            title: "轻度焦虑型",
            description: "你经常会担心失去伴侣，需要频繁的爱意确认才能安心。",
            pattern: "这是典型的'焦虑型依恋'模式"
        },
        low: {
            score: "36-43",
            title: "严重不安型",
            description: "你严重缺乏安全感，总是担心伴侣会离开。",
            suffering: "你自己活得很痛苦，伴侣也感到压力"
        },
        veryLow: {
            score: "44-50",
            title: "极度恐惧型",
            description: "你生活在对被抛弃的极度恐惧中，建议寻求专业帮助。"
        }
    }
};

/**
 * 个性化建议库 - 完整版（确保无乱码）
 * 每个Level 5套随机建议，与 enhancedRPIAnalysis 呼应
 */
const personalizedGoalsLibrary = {
    
    // ==========================================
    // Level 1: 完美健康 (RPI 0-35)
    // ==========================================
    1: [
        // 【建议套装 1：佛系达人版】
        {
            小提醒: "你的恋爱状态很健康，但太佛系也有个小风险：对方可能会误以为你'不够在乎'。毕竟不是每个人都能理解'我不查岗是因为我信任你'这种高级浪漫。",
            
            行动建议: `🌟 本周任务：主动制造一次小惊喜
比如突然说"今晚我想你了，出来吃个饭吧"。不需要多么隆重，就是让TA知道：你的淡定不是冷漠，而是成熟的爱。

💬 沟通升级：偶尔"装"一下小作
下次TA晚回家，试着半开玩笑地说："哼，你去哪儿了？是不是外面有狗了？"然后笑着抱住TA。这种带着安全感的撒娇，会让关系更有温度。

📚 进阶阅读：《亲密关系》
你已经做得很好了，这本书能帮你理解：为什么有些人就是学不会你这种自在。了解差异，能让你在遇到焦虑型伴侣时更有耐心。`,
            
            金句: "真正的爱，是两个独立的人选择在一起，而不是两个半人拼凑成一个。"
        },

        // 【建议套装 2：独立人格版】
        {
            小提醒: "你是那种'有你很好，没你我也能活得精彩'的人。但请记住：伴侣不是室友。偶尔表达一下'我需要你'，不会让你显得脆弱，反而会让TA感受到被需要的幸福。",
            
            行动建议: `🎯 本月挑战：暴露一次脆弱
找个时间，真诚地对TA说："上次你帮我那个忙，我心里特别温暖。"或者生病时撒个娇："我有点不舒服，你能陪陪我吗？"这种示弱不丢人，反而会让关系更紧密。

❤️ 爱的仪式感：建立固定约会日
每周或每两周，雷打不动地安排一次"只属于我们俩"的时间。可以是看电影、散步、或者就在家做饭。重点不是活动本身，而是这种"我把时间留给你"的仪式感。

🎁 小心机：偶尔主动汇报行踪
不是因为对方要求，而是你主动分享："我在XX，突然想告诉你一声。"这种非必要的分享，会让TA感受到"被放在心上"的甜蜜。`,
            
            金句: "独立不是疏离，而是用完整的自己去爱另一个完整的人。偶尔靠近一点，不会让你失去自由。"
        },

        // 【建议套装 3：信任典范版】
        {
            小提醒: "你用实际行动诠释了什么叫'信任'。你不翻手机、不查岗、不疑神疑鬼。但信任是双向的，在你给予对方充分信任的同时，也要确保对方感受到了。有时候，适度的'在意'也是爱的证明。",
            
            行动建议: `🗣️ 沟通金句："我信任你，但我也在乎你"
找个轻松的时机，和TA聊聊："我不常问你去哪儿，不是因为我不关心，而是我相信你。但如果你愿意主动告诉我，我会很开心。"这样既表达了信任，也传递了在乎。

💝 小惊喜清单：准备5个低成本浪漫
• 手写一张小卡片藏在TA包里
• 突然订TA最喜欢的外卖
• 发一条语音："没事，就是想听听你的声音"
• 周末早起做个早餐
• 给TA买个小礼物（不超过50块的那种）

🎮 关系游戏：36个问题
网上有个著名的"36个问题让陌生人相爱"，你们可以玩玩进阶版。每周选3个问题，睡前聊聊。你会发现，即使是老夫老妻，也能聊出新鲜感。`,
            
            金句: "你已经做到了90分的信任，剩下10分的甜蜜粘腻，能让关系从优秀变成完美。"
        },

        // 【建议套装 4：成熟恋爱版】
        {
            小提醒: "你的恋爱观非常成熟：爱一个人，不是占有TA，而是欣赏TA。但成熟≠冷静到无趣。爱情需要一点点'不理智'的浪漫。偶尔任性一下、冲动一下，会让关系更有生命力。",
            
            行动建议: `🎪 解锁新体验：做一件平时不会做的事
• 如果你俩通常很理性，那就来一次说走就走的周末旅行
• 如果你俩很宅，那就突然报个双人瑜伽课
• 如果你俩很严肃，那就去游乐场疯玩一天
打破常规，制造新鲜感。

📸 记忆银行：建立"我们的时刻"相册
不是简单拍照，而是记录那些小瞬间：TA傻笑的样子、你们一起做饭的乱七八糟、窗外的晚霞和TA的侧脸。几年后翻看，这些才是最珍贵的。

🌙 深夜谈心：每月一次"无手机夜晚"
选一个晚上，两个人都把手机放在另一个房间，面对面聊天到困。聊童年、聊梦想、聊对未来的设想。你会发现，最深的连接发生在最简单的对话里。`,
            
            金句: "成熟的爱是放手，但别忘了偶尔牵手。太理性的爱情，会失去爱情本该有的温度。"
        },

        // 【建议套装 5：轻松派对版】
        {
            小提醒: "如果恋爱也有奖学金，你肯定年年都能拿全额。但太优秀也有个bug：有时候会让对方觉得'我好像可有可无'。毕竟人性就是这样，太容易得到的就不珍惜。",
            
            行动建议: `🎲 制造点小考验（善意的那种）
• 偶尔故意"冷淡"半天，然后晚上突然特别热情："想死你了！"
• 神秘兮兮地说"我有个秘密"，吊足胃口后说："秘密就是我爱你"
• 假装生气，看TA怎么哄你（但要适度，别玩脱了）
这种小情趣，能让平淡的日子冒点泡泡。

🎨 创意约会：做点没做过的事
列个清单，每个月打卡一项：一起学一道新菜、去从没去过的街区瞎逛、在家搭个帐篷露营、互相画对方、一起看一部两个人都没兴趣的电影看谁先睡着。

💌 爱的邮局：给未来的TA写信
各自写一封信，写给"5年后的我们"，密封后约定某个日期一起拆开读。这种仪式感，会成为你们关系的小锚点。`,
            
            金句: "你已经满分了，现在是时候加点'附加题'——那些让爱情闪闪发光的小浪漫。"
        }
    ],

    // ==========================================
    // Level 2: 良好平衡 (RPI 36-50)
    // ==========================================
    2: [
        // 【建议套装 1：黄金平衡版】
        {
            小提醒: "你找到了恋爱中最舒服的状态——在乎，但不过分；关心，但不控制。你会因为伴侣的某些行为吃醋，但能理性地处理这种情绪。这种'恰到好处'的爱，让你们既有亲密感，又不会互相窒息。",
            
            行动建议: `🎯 情绪管理：建立"冷静缓冲期"
当你感到不爽时，给自己10分钟冷静时间。问自己："我现在的情绪，是基于事实还是想象？"通常这10分钟能帮你拦下80%会后悔的话。

💬 沟通升级：用"我感到"代替"你总是"
比如，不说"你总是不理我"，改成"当你忙到很晚时，我会感到有点孤单"。这种表达方式，能让对方听进去而不是反击。

📅 关系维护：每月一次"我们的复盘"
找个轻松的时间，聊聊这个月彼此做得好的地方，也说说有哪里可以改进。就像给关系做个SPA，定期保养才能长久。`,
            
            金句: "你已经在健康关系的正确轨道上了。继续保持这种平衡感，学会在感到不安时用成熟的方式沟通，而不是压抑或爆发。"
        },

        // 【建议套装 2：适度在意版】
        {
            小提醒: "你的占有欲就像调味的盐——适量就是完美。你不是那种'佛系到冷漠'的人，也不是'爱到窒息'的类型。看到TA和异性聊天会在意，但不会歇斯底里；想知道TA在哪里，但不会GPS定位跟踪。这个度，刚刚好。",
            
            行动建议: `🎭 情绪识别：给你的小醋坛子取个名字
当吃醋情绪出现时，幽默地对自己说："哦，小醋坛子又出来了。"这种自我觉察，能帮你跳出情绪看问题，而不是被情绪淹没。

🗨️ 表达技巧：把抱怨变成请求
不说"你为什么不多陪陪我"，改成"这周末我们一起做点什么吧，我想你了"。同样的需求，正向表达更容易被满足。

🎁 惊喜储备：准备3个"我爱你"的方式
不只是说"我爱你"，试试：给TA按摩、做TA喜欢吃的菜、或者就静静陪TA看会儿电视。爱有一千种表达方式，找到你们的专属语言。`,
            
            金句: "保持现状就很好。偶尔觉得不安时，试着先问问自己：'我是真的发现了问题，还是在自己吓自己？'大多数时候，你会发现是后者。深呼吸，然后该干嘛干嘛。"
        },

        // 【建议套装 3：真实恋人版】
        {
            小提醒: "你是一个很真实的恋人。你有七情六欲，会有小嫉妒和小脾气，但这正是你可爱的地方。你没有被占有欲冲昏头脑，当理智回归时，你总能做出尊重的选择。你的伴侣会觉得你既在乎TA，又很讲道理。",
            
            行动建议: `😊 可爱表达：当你吃醋时，不妨直接撒个娇
与其生闷气，不如直接说"我吃醋了"。这种坦率的表达往往比冷战更有效，也能把吃醋变成情趣。

🎯 关系定位：明确你们的"安全界限"
和TA聊聊：什么样的异性交往是你们都能接受的？什么是红线？把模糊的不安变成清晰的共识，能减少很多不必要的猜忌。

🌱 共同成长：一起学点新东西
报个双人课程（舞蹈、烘焙、摄影都行），在学习新技能的过程中，你们会发现彼此新的一面，关系也会更紧密。`,
            
            金句: "当你吃醋的时候，不妨直接撒个娇说'我吃醋了'，而不是生闷气。这种坦率的表达往往比冷战更有效，也能把吃醋变成情趣。"
        },

        // 【建议套装 4：平衡艺术版】
        {
            小提醒: "你的RPI指数显示你处于'黄金分割点'。你有警觉性，这能保护关系免受外界干扰；但你没有攻击性，这能保护伴侣免受内部压力。你懂得在原则问题上坚定，在小事上糊涂。",
            
            行动建议: `🧘 内心修炼：培养"钝感力"
不是对TA的感受迟钝，而是对外界杂音迟钝。朋友圈的小互动、同事聚餐的照片，学会"看见了，但不往心里去"。这种钝感力是成熟爱情的必修课。

💡 换位思考：每周做一次"角色互换"
想象如果你是TA，面对你的这些要求/情绪会是什么感受？这个练习能帮你更好地理解TA的处境。

🎪 生活调剂：引入"第三方快乐"
两个人的世界容易陷入审美疲劳，引入新元素：养个宠物、一起追个剧、或者认识新朋友。有了共同的兴趣点，关系会更有活力。`,
            
            金句: "继续修炼这种智慧。当遇到让你们产生分歧的事情时，多换位思考。你的平衡能力是你维护长期关系的最大优势。"
        },

        // 【建议套装 5：渐入佳境版】
        {
            小提醒: "你们的关系正处于一个很好的阶段。有安全感，但不是麻木；有在意，但不是控制。这种状态说明你们已经度过了热恋期的失控，也还没到老夫老妻的无感。好好珍惜这个阶段。",
            
            行动建议: `📖 关系日记：记录"我们的小确幸"
不是写流水账，而是记录那些让你心动的瞬间：TA说的一句暖心话、一个贴心的举动、或者你们一起笑到肚子疼的事。几个月后翻看，满满都是爱。

🎯 目标同步：每季度来个"我们会议"
不是开严肃的会，就是找个时间聊聊：接下来想一起做什么？有什么目标要达成？这种仪式感能让你们有"并肩作战"的感觉。

🌸 保持新鲜：定期做点"第一次"
第一次去某个地方、第一次尝试某种美食、第一次一起挑战某件事。这些"第一次"会持续给关系注入新鲜感。`,
            
            金句: "你们正在最美好的阶段：既有激情的余温，又有信任的底色。继续保持这种节奏，爱情会越来越醇厚。"
        }
    ],

    // ==========================================
    // Level 3: 中等偏高 (RPI 51-70)
    // ==========================================
    3: [
        // 【建议套装 1：十字路口版】
        {
            小提醒: "你的占有欲指数在中等偏高水平，这意味着你正站在一个十字路口：往左是健康的关心，往右是过度的控制。现在的你，对伴侣的行为比较敏感，会希望掌握TA的动态。虽然还没到让对方窒息的程度，但某些时刻，TA可能已经感受到了压力。",
            
            行动建议: `⚠️ 及时刹车：识别"控制欲抬头"的信号
当你发现自己开始频繁查看TA的朋友圈、追问行踪、或者因为TA没秒回而焦虑时，这就是信号。告诉自己："暂停，我需要冷静一下。"

🌳 培养爱好：找回"不依赖TA"的快乐
这周开始，找一个完全属于你自己的兴趣（健身、画画、学语言都行）。每周至少花3小时在这上面。你越充实，就越不会把全部注意力放在伴侣身上。

💬 诚实对话："我最近有点焦虑"
找个合适的时间，坦白地告诉TA："我发现我最近有点黏人/多疑，这可能让你不舒服。我正在努力调整，但如果我做过了，请提醒我。"这种自我觉察会让TA更理解你。`,
            
            金句: "这是一个需要注意的临界点。如果不加注意，你的'在乎'可能会慢慢变成'监控'。建议从现在开始培养自己的兴趣爱好，建立独立的社交圈。记住：你越充实，就越不会把全部注意力放在伴侣身上。"
        },

        // 【建议套装 2：诚实面对版】
        {
            小提醒: "说实话，你有点太在意伴侣了。TA的一条朋友圈、一个点赞、一次晚归，都能让你心里泛起波澜。你不是不信任TA，而是太害怕失去TA。这种焦虑感，正在一点点影响你们的相处质量。",
            
            行动建议: `🛑 停下来，深呼吸
问问自己：我到底在怕什么？是怕TA变心，还是怕自己不够好？找到恐惧的根源，才能真正解决问题。也许你需要的不是一个'更老实'的伴侣，而是一个更强大的自己。

📵 数字排毒：设置"不看手机时间"
每天晚上8点到10点，把手机放在另一个房间。不看TA的朋友圈，不查聊天记录，不等消息回复。用这两小时做点让你开心的事。你会发现，世界并没有因为你不盯着手机而崩塌。

🎯 重建自信：列出"我很棒"清单
写下10件你做得很好的事（和伴侣无关）。工作成就、个人技能、朋友评价...任何能证明"我是有价值的"的事。每天看一遍，提醒自己：我值得被爱，不是因为我能控制对方，而是因为我本身就很好。`,
            
            金句: "停下来，深呼吸。问问自己：我到底在怕什么？是怕TA变心，还是怕自己不够好？找到恐惧的根源，才能真正解决问题。也许你需要的不是一个'更老实'的伴侣，而是一个更强大的自己。"
        },

        // 【建议套装 3：灰色地带版】
        {
            小提醒: "你处于占有欲的'灰色地带'——还没糟糕到关系破裂，但已经开始影响你们的日常相处。伴侣可能觉得和你在一起有点累，需要时刻注意你的情绪；而你也累，总是在担心、怀疑、不安中度过。",
            
            行动建议: `🎭 角色扮演：当一天"零占有欲"的人
挑一个周末，刻意练习完全不问TA的行踪、不查手机、不追问任何事。就当自己是个'佛系恋人'。体验一下那种放松的感觉，你会发现，天也不会塌下来。

🧘 冥想练习：每天10分钟"放下执念"
找个安静的地方，闭眼深呼吸。想象你把对TA的所有担心、猜疑都装进一个气球，然后放手看它飞走。这不是放弃爱TA，而是放下对控制的执着。

📞 求助朋友：找个"情绪垃圾桶"
当你又想查岗、又想发火时，先打给一个理智的朋友倾诉10分钟。让朋友帮你判断：你是真的发现了问题，还是在自己吓自己？通常都是后者。`,
            
            金句: "是时候做出改变了。这种焦虑感会榨干你的能量，让你变成一个连自己都不喜欢的人。从小事做起：今天不看TA的朋友圈、这周末不问TA的行踪，试试看，其实天也不会塌下来。"
        },

        // 【建议套装 4：内心小孩版】
        {
            小提醒: "你的内心可能住着一个'缺乏安全感的小孩'。当伴侣不在视线范围内时，这个小孩就开始哭闹，让你想要抓紧对方。这并不是因为你强势，恰恰是因为你内心柔软且脆弱。",
            
            行动建议: `🧸 安抚内心小孩：自我对话练习
当焦虑来袭时，想象你在安抚一个害怕的小孩。告诉TA："我知道你害怕被抛弃，但你是安全的。对方爱你，即使TA现在不在身边。"用成年人的理性，去安抚内心的感性。

💪 建立自我价值：做一件"为自己骄傲"的事
可以是完成一个工作目标、学会一项新技能、或者帮助一个朋友。让自己感受到"我是有价值的，即使TA不在我身边"。

🎨 情绪出口：找一个健康的宣泄方式
写日记、画画、跑步、打游戏...找到一个不伤害关系的方式来释放焦虑。不要让伴侣成为你唯一的情绪出口，那对TA来说太沉重了。`,
            
            金句: "试着安抚内心的那个小孩，而不是通过控制伴侣来止痛。告诉自己：'我是值得被爱的，即使TA现在不在我身边。'这种自我安抚的能力，是你成长的必修课。"
        },

        // 【建议套装 5：沙漏效应版】
        {
            小提醒: "你正在玩一个危险的游戏：你试图通过收紧手中的沙子来留住它。但常识告诉我们，握得越紧，沙子流失得越快。你频繁的确认和查岗，可能正在把伴侣推开。",
            
            行动建议: `✋ 松手练习：信任肌肉训练
信任就像肌肉，是需要锻炼的。下一次你想查岗的时候，强迫自己忍住，去做点别的事。每一次忍耐，都是在锻炼你的'信任肌肉'。一个月后，你会发现这种冲动减弱了很多。

🎯 转移目标：把精力投资在自己身上
制定一个30天自我提升计划：读3本书、学会做5道新菜、或者减重5斤。把盯着对方的精力，转移到投资自己上。一个月后，你会变得更有魅力，而不是更焦虑。

📝 记录成长：每天写"今天我没有..."
"今天我没有查看TA的聊天记录"、"今天我没有追问TA的行踪"...每天记录一个你克制住的冲动。一个月后翻看，你会为自己的进步感到骄傲。`,
            
            金句: "试着松开手。信任就像肌肉，是需要锻炼的。下一次你想查岗的时候，强迫自己忍住，去做点别的事。每一次忍耐，都是在锻炼你的'信任肌肉'。"
        }
    ],

    // ==========================================
    // Level 4: 偏高水平 (RPI 71-85)
    // ==========================================
    4: [
        // 【建议套装 1：严肃警告版】
        {
            小提醒: "你的占有欲已经到了需要认真重视的程度。你可能经常查看伴侣的手机、追问TA的行踪，甚至会因为一些小事大发脾气。你告诉自己'这是因为我太爱TA'，但这种高压的相处模式，正在让你们的感情迅速内耗。",
            
            行动建议: `🚨 紧急刹车：认识到严重性
这已经不是"小吃醋"的程度了。如果不立即做出改变，你们的相处模式会变得越来越累。想象一下：如果有人这样对你，你能承受多久？是时候从对方的角度看问题了。

🧘 情绪管理：建立"冷静SOP"
制定一个标准流程：当你想发火/查岗时，①离开现场 ②深呼吸10次 ③喝杯水 ④问自己"这件事值得吗？" ⑤如果还觉得值得，再用平和的语气沟通。这5步能帮你避免90%的冲动行为。

🎯 重建生活：给自己安排"满满当当"的一周
报个课、约朋友、看展览、运动...把每天都排满。当你忙到没空胡思乱想时，你会发现关系反而轻松了很多。`,
            
            金句: "这是一个严肃的提醒：如果不立即做出改变，你们的相处模式会变得越来越累。试着给彼此更多的自由，把关注点重新放回自己身上。当你再次变得闪闪发光时，你们的关系也会更轻松、更美好。"
        },

        // 【建议套装 2：直白内省版】
        {
            小提醒: "让我们诚实一点：你正在用'爱'的名义，做着消耗感情的事。监控手机、过度追问...这些行为，正在一点点消耗伴侣对你的耐心。你可能觉得'如果TA真的爱我，就应该理解我'，但换位思考一下：如果有人这样对你，你能承受多久？",
            
            行动建议: `🪞 残酷照镜子：录下你发火的样子
下次你情绪失控时，让朋友帮你录像（或录音）。事后冷静下来，看看那个歇斯底里的人。问问自己：这是我想成为的样子吗？这种震撼教育，往往比任何说教都有效。

📵 强制隔离：物理上远离诱惑
把TA的社交账号设置为"不看TA的动态"，删除定位共享，甚至可以把手机交给朋友保管几小时。用物理隔离来对抗心理冲动。一开始会很难受，但坚持一周，你会适应的。

💬 坦诚沟通："我知道我有问题"
找个时间，认真地对TA说："我知道我最近的行为让你很累。我正在努力改变，但可能需要时间。如果我又犯了，请直接告诉我，而不是忍着。"这种坦诚，是重建信任的第一步。`,
            
            金句: "是时候面对现实了。你需要的不是一个'更听话'的伴侣，而是把精力从监视转移到自我建设上。为你自己，认真对待并改变这个相处模式，因为这份焦虑感主要在折磨你自己。"
        },

        // 【建议套装 3：温柔理解版】
        {
            小提醒: "我能感受到你内心的恐惧和不安。你这么做，不是因为你坏，而是因为你太害怕了——害怕被忽视、害怕不够好。你试图通过控制伴侣来获得安全感。但讽刺的是，你越抓越紧，双方的相处就越沉重。",
            
            行动建议: `💝 自我疗愈：找到恐惧的源头
静下来问自己：我到底在怕什么？是童年缺爱？是被前任伤害过？还是对自己不自信？找到根源，才能对症下药。必要时，寻求心理咨询师的帮助，这不丢人。

🌱 小步前进：设定"微目标"
不要指望一夜之间变成佛系恋人。从小目标开始：今天不查手机、明天不追问行踪、后天试着相信TA说的话。每完成一个小目标，都奖励自己一下。

🤝 寻求支持：告诉TA你在努力
"我知道我的焦虑给你带来了压力。我正在寻求帮助（看心理医生/读书/练习冥想）。这个过程可能会有反复，希望你能理解。"让TA知道你在努力，会让TA更愿意陪你度过这段时期。`,
            
            金句: "你值得被爱，也值得拥有健康的关系。但首先，你需要学会爱自己、相信自己。真正的安全感，只能来自你的内心强大，而不是伴侣的手机密码或行踪报告。"
        },

        // 【建议套装 4：角色隐喻版】
        {
            小提醒: "你的关系模式已经亮起了红灯。你把自己变成了这段关系的'警察'，而伴侣变成了'嫌疑人'。每一天都像是在审讯和辩解中度过，这种高压环境会让爱情的甜度迅速下降。",
            
            行动建议: `👮 卸下警徽：停止执法
爱情不是执法，不需要寻找证据。试着给对方哪怕一天的完全信任，不查手机、不问行踪、不质疑解释。记录下这一天你的感受：是天塌了？还是其实也没那么可怕？

🎭 换个剧本：从审问者变成倾听者
不要再用质问的语气说话。下次想问"你去哪了？和谁在一起？"时，改成"今天过得怎么样？有什么开心的事吗？"同样是了解对方，温柔的询问比审讯更有效。

📚 自我教育：了解"控制型人格"
读一些心理学书籍（推荐《依恋》《亲密关系的恐惧》），了解为什么你会有这种倾向。知识是改变的第一步。`,
            
            金句: "卸下你的警徽吧。爱情不是执法，不需要寻找证据。尝试给对方哪怕一天的完全信任，看看会发生什么。你会发现，信任带来的轻松感，远比怀疑带来的痛苦要值得。"
        },

        // 【建议套装 5：反复无常版】
        {
            小提醒: "你的RPI分数显示你很渴望亲密，但又恐惧被伤害。这种矛盾让你反复无常：一会儿对TA极好，一会儿又情绪爆发。这对伴侣来说是一种巨大的情感考验。",
            
            行动建议: `📊 情绪记录：追踪你的波动规律
每天晚上花5分钟，记录今天的情绪状态（1-10分）和触发点。一周后回顾，你会发现一些规律：什么情况下你容易失控？是工作压力大？还是生理期？还是TA特定的某些行为？找到规律，就能提前预防。

🎯 设定边界：建立"情绪红绿灯"
和TA约定一个系统：
• 绿灯：我状态很好，可以聊任何话题
• 黄灯：我有点烦躁，说话可能冲，但不是针对你
• 红灯：我现在情绪很差，需要独处一会儿
这样TA就不会摸不着头脑，你也有了缓冲空间。

🧘 情绪急救：准备你的"冷静工具箱"
在包里或车里准备一些能让你快速冷静的东西：薄荷糖、减压球、耳机（里面存好舒缓音乐）、或者一张写着"深呼吸，不是世界末日"的小卡片。情绪上头时，拿出来用。`,
            
            金句: "请多了解一些相处技巧。当情绪上头时，给自己设置一个'10分钟冷静期'，等平静后再沟通。用理智来管理情绪，而不是让情绪来主导关系。"
        }
    ],

    // ==========================================
    // Level 5: 很高水平 (RPI 86-100)
    // ==========================================
    5: [
        // 【建议套装 1：温柔聚焦版】
        {
            小提醒: "你是一个'为爱痴狂'的人，很容易被这段关系完全占据。你可能将大部分的快乐和精力都投入到了伴侣身上，导致自己很容易陷入情绪的漩涡。你的爱很深，但表达方式可能过于沉重，让彼此都感到透不过气。",
            
            行动建议: `🎯 生活重启：按下"个人生活重启键"
现在是时候拿回属于自己的生活了。把对伴侣80%的关注度，分40%给自己。报个课、学个新技能、重拾旧爱好。不是为了TA，纯粹为了你自己。

💪 重建自信：每周完成一个"我很棒"
设定小目标：这周学会一道新菜、读完一本书、跑步5公里、或者帮朋友解决一个问题。每完成一件，都在手机备忘录里记下"我做到了XX"。一个月后，你会发现自己远比想象中强大。

🌈 扩大社交：每周至少一次"无TA社交"
约老朋友吃饭、参加兴趣小组、或者就是一个人去咖啡馆坐坐。重新找回那个"不依赖任何人也能快乐"的自己。记住：你吸引TA的，正是那个独立发光的你。`,
            
            金句: "现在是时候按下'个人生活重启键'了。把对伴侣80%的关注度，分40%给自己。挑战自己去尝试一项全新的运动或兴趣爱好，你很快会发现：当你更爱自己时，你的吸引力也会成倍增加。"
        },

        // 【建议套装 2：魅力恢复版】
        {
            小提醒: "你的世界里，这段关系占的比重太大了，导致你个人的光芒都有点被遮盖了。一旦伴侣不在身边，你可能就会感到强烈的空虚和不安。这种状态，消耗的是你自己，也让原本轻松的爱情变得辛苦。",
            
            行动建议: `📅 强制安排：每周3个"我的时间"
周一、周三、周五晚上，这是"我的时间"，不约TA，不聊天，专心做自己的事。可以运动、看书、见朋友、学习、甚至发呆。刚开始会不习惯，坚持一个月，你会爱上这种感觉。

💰 投资自己：给自己的账户"充值"
不只是钱，还有时间、精力、关注。把你花在焦虑、猜疑、查岗上的时间，全部收回来投资自己。学一门课、考个证、或者就是好好保养皮肤。当你变得更好，关系自然也会变好。

🎭 角色练习：假装你是单身
这不是真的要分手，而是做个思想实验。如果你现在单身，你会怎么安排今天？去哪里？做什么？然后就真的去做。你会发现，离开TA你也能活得很精彩。`,
            
            金句: "请给自己放个长假，从'爱情岗位'上短暂休息一下。给自己制定一个'快乐清单'，上面只写能让你一个人感到快乐的事情。记住，你最初吸引TA的，就是你独立发光的样子。"
        },

        // 【建议套装 3：轻松挑战版】
        {
            小提醒: "我必须告诉你一个秘密：你现在最累的人是你自己。你把太多时间花在担心、猜测和确认上，这份焦虑感正在榨干你的能量。这种沉重的相处模式，会让你和伴侣都失去恋爱的乐趣。",
            
            行动建议: `🎮 游戏化改变：30天"信任挑战"
把改变变成游戏。制作一个打卡表，每天完成一个小任务：
• 第1-3天：不主动问"你在干嘛"
• 第4-7天：不看TA的朋友圈
• 第8-14天：晚上9点后不联系TA
• 第15-21天：一个人去做一件想做的事
• 第22-30天：给TA一个完全自由的周末
每完成一天，给自己一个小奖励。

🎨 创意宣泄：找个艺术化的出口
不要让伴侣成为你唯一的情绪垃圾桶。画画、写作、唱歌、跳舞...任何能让你释放情绪的方式都行。把那些焦虑、不安、猜疑转化成创作的能量。

🤝 结伴同行：找个"同病相怜"的朋友
如果有朋友也是这种性格，约定互相监督。每当你想查岗时，先给TA打电话聊10分钟。让朋友成为你的"理智代理人"。`,
            
            金句: "我们来玩个小游戏：给自己设定一个'信任周'挑战。在一周内，强制自己对伴侣的行踪和社交采取'选择性失明'，把节省下来的精力用来和朋友大笑一场，或者学习一项新技能。你会发现，生活远比你想象的更精彩。"
        },

        // 【建议套装 4：关系透气版】
        {
            小提醒: "你的爱像一张密不透风的网，虽然是为了保护关系，但却让网中的人失去了呼吸的空间。你可能在无意识中，让伴侣感觉到了强烈的束缚感。爱是希望彼此都自由，而不是互相被困住。",
            
            行动建议: `🌬️ 关系通风：主动提出"透气时间"
不要等到TA受不了提出分手，主动提议："这周末我们各自和朋友玩，不联系不查岗，周日晚上再见面分享彼此的快乐。"这种主动放手，反而会让TA更感激。

💬 诚实对话：承认你的焦虑
找个合适的时机，平静地说："我发现我最近有点太粘人了。我在努力调整，给你多一点自由，也给我自己多一点空间。如果你感觉我又'犯病'了，请直接提醒我。"

🎯 设立界限：给自己定规矩
写下来贴在显眼处：
• 不在深夜查看TA的社交动态
• 同一个问题不问超过两遍
• TA说"我在忙"就接受，不追问
• 每天给自己2小时不想TA的事
这些是你给自己设的底线，遵守它们。`,
            
            金句: "请给你们的关系'通通风'。可以和伴侣坦诚聊聊：'我发现我最近有点太粘人了，我打算给你多一点自由，也给我自己多一点空间。'主动做出调整，会让伴侣看到你愿意为这段关系变得更好的努力。"
        },

        // 【建议套装 5：自我增值版】
        {
            小提醒: "你可能在不知不觉中，把所有的鸡蛋都放在了'爱情'这一个篮子里。一旦这个篮子有点晃动，你就会感到世界末日。你需要的是多几个坚固的'篮子'，比如友谊、事业、个人成就。",
            
            行动建议: `📚 知识武装：系统学习"安全型依恋"
推荐书单：
• 《依恋：为什么我们爱得如此艰难》
• 《被讨厌的勇气》  
• 《自卑与超越》
了解你的焦虑从哪里来，才知道怎么解决。每天读30分钟，做读书笔记。知识是改变的开始。

💼 事业聚焦：给工作/学习加点码
设定一个3个月的职业目标：升职、学新技能、完成一个项目。把你盯着伴侣的精力，转移到提升自己上。当你在工作上有成就感时，对爱情的执念会自然减轻。

🏃 身体革命：建立运动习惯
焦虑很大程度上是生理问题。每周运动3次，每次30分钟以上。跑步、游泳、瑜伽、拳击...任何让你出汗的运动。当你的身体健康了，心理状态也会好很多。`,
            
            金句: "为了你自己的幸福感,现在必须重新平衡你的生活。立即拿起你曾经放下的兴趣，或者去结识一些新的朋友。只有当你重新成为一个丰盛的个体时，你的爱情才会变得轻松、有趣、牢不可摧。"
        }
    ]
};

/**
 * 修改后的 generateGoals 函数 - 使用新的建议库
 */
function generateGoals(rpi, level) {
    // 从对应的 Level 随机选择一套建议
    const goalsOptions = personalizedGoalsLibrary[level];
    
    if (!goalsOptions || goalsOptions.length === 0) {
        // 如果没有对应的建议，返回默认内容
        return `💡 个性化建议
根据你的RPI分数，建议你：
• 保持平衡的爱情关系
• 给彼此适度的空间
• 学会健康地表达情感需求`;
    }
    
    // 随机选择一套
    const selected = goalsOptions[Math.floor(Math.random() * goalsOptions.length)];
    
    // 直接返回格式化后的文本
    return `⚠️ 小提醒
${selected.小提醒}

📋 行动建议
${selected.行动建议}

💎 金句
${selected.金句}`;
}

// 导出函数
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        personalizedGoalsLibrary,
        generateGoals
    };
}

if (typeof window !== 'undefined') {
    window.personalizedGoalsLibrary = personalizedGoalsLibrary;
    window.generateGoals = generateGoals;
}

console.log('✅ personalizedGoalsLibrary 加载完成 - 共5个Level，每个Level 5套建议');

/**
 * 识别复杂的维度组合模式
 */
function identifyDimensionPatterns(dimensions) {
    const d = dimensions;
    const patterns = [];
    
    // 三高组合：控制、嫉妒、依赖都高
    if (d.control.percent > 70 && d.jealousy.percent > 70 && d.dependency.percent > 70) {
        patterns.push(dimensionCombinationLibrary.tripleHigh);
    }
    
    // 高控制低依赖：独立的控制者
    else if (d.control.percent > 70 && d.dependency.percent < 40) {
        patterns.push(dimensionCombinationLibrary.controlButIndependent);
    }
    
    // 低控制高嫉妒：隐忍的焦虑者
    else if (d.control.percent < 40 && d.jealousy.percent > 70) {
        patterns.push(dimensionCombinationLibrary.jealousButNotControlling);
    }
    
    // 高依赖低安全感：焦虑型依恋
    else if (d.dependency.percent > 70 && d.security.percent > 70) {
        patterns.push(dimensionCombinationLibrary.anxiousAttachment);
    }
    
    // 四维度平衡：成熟恋爱者
    else if (Math.max(d.control.percent, d.jealousy.percent, d.dependency.percent, d.security.percent) < 60) {
        patterns.push(dimensionCombinationLibrary.balanced);
    }
    
    // 高控制低嫉妒：理性控制者
    else if (d.control.percent > 70 && d.jealousy.percent < 40) {
        patterns.push(dimensionCombinationLibrary.controlButNotJealous);
    }
    
    return patterns;
}

/**
 * 获取维度的深度分析
 */
function getDimensionDeepAnalysis(dimensionName, score) {
    const analysis = dimensionDeepAnalysis[dimensionName];
    if (!analysis) return null;
    
    // 根据分数判断属于哪个级别
    if (score <= 10) return analysis.veryLow;
    if (score <= 25) return analysis.low;
    if (score <= 35) return analysis.medium;
    if (score <= 43) return analysis.high;
    return analysis.veryHigh;
}

/**
 * 生成个性化分析内容
 */
function generatePersonalizedAnalysis(rpi, level, dimensions) {
    // 从enhancedRPIAnalysis随机或按顺序选择一套描述
    const rpiDescriptions = enhancedRPIAnalysis[level];
    const selected = rpiDescriptions[Math.floor(Math.random() * rpiDescriptions.length)];
    
    return {
        meaning: selected.meaning,
        levelAdvice: selected.suggestion,
        goals: generateGoals(rpi, level),
        tone: selected.tone
    };
}

/**
 * 确定RPI等级 (1-5)
 */
function determineLevel(rpi) {
    if (rpi < 36) return 1;      // 健康水平
    if (rpi < 51) return 2;      // 良好水平
    if (rpi < 71) return 3;      // 中等偏高
    if (rpi < 86) return 4;      // 需要重视
    return 5;                     // 严重水平
}

/**
 * 获取等级名称
 */
function getLevelName(level) {
    const names = {
        1: "健康(自由自在)",
        2: "良好(恰到好处)",
        3: "中等(需要注意)",
        4: "偏高(需要重视)",
        5: "很高(爱到极致)"
    };
    return names[level] || "未知";
}

/**
 * 获取等级颜色
 */
function getLevelColor(level) {
    const colors = {
        1: "#64c864",   // 绿色
        2: "#90c890",   // 浅绿
        3: "#ffc864",   // 黄色
        4: "#ff9264",   // 橙色
        5: "#ff6b9d"    // 红色
    };
    return colors[level] || "#999";
}

/**
 * 计算百分位
 */
function calculatePercentile(rpi) {
    // 简化版：基于正态分布估算
    const percentile = Math.min(95, Math.max(5, Math.round((rpi / 100) * 100)));
    return `超过了 ${percentile}% 的测试者`;
}

/**
 * 主计算函数：计算RPI和所有相关数据
 */
function calculateRPI(answers, testMode = 'self') {
    console.log('=== 开始计算RPI ===');
    console.log('答案数组:', answers);
    console.log('测试模式:', testMode);
    
    // 确保有42个答案
    if (!answers || answers.length !== 42) {
        console.error('❌ 答案数量不正确，需要42个答案，当前:', answers?.length);
        return null;
    }
    
    // 计算四个维度的分数
    const dimensions = calculateDimensions(answers);
    console.log('维度计算结果:', dimensions);
    
    // 计算总RPI分数（四个维度的加权平均）
    const rpi = Math.round(
        (dimensions.control.score + 
         dimensions.jealousy.score + 
         dimensions.dependency.score + 
         dimensions.security.score) / 2
    );
    
    console.log('RPI总分:', rpi);
    
    // 确定等级
    const level = determineLevel(rpi);
    console.log('等级:', level);
    
    // 识别维度组合模式
    const patterns = identifyDimensionPatterns(dimensions);
    console.log('识别到的模式:', patterns);
    
    // 为每个维度添加深度分析和组合模式
    Object.keys(dimensions).forEach(key => {
        dimensions[key].deepAnalysis = getDimensionDeepAnalysis(key, dimensions[key].score);
        dimensions[key].patterns = patterns;
    });
    
    // 生成个性化分析
    const personalizedAnalysis = generatePersonalizedAnalysis(rpi, level, dimensions);
    
    // 返回完整结果
    const result = {
        rpi,
        level,
        levelName: getLevelName(level),
        levelColor: getLevelColor(level),
        percentile: calculatePercentile(rpi),
        testMode,
        timestamp: new Date().toISOString(),
        dimensions,
        personalizedAnalysis
    };
    
    console.log('=== 最终结果 ===');
    console.log(result);
    
    return result;
}

/**
 * 计算四个维度的分数 - 修复版
 */
function calculateDimensions(answers) {
    console.log('开始计算维度，答案总数:', answers.length);
    
    // 题目分配
    // 控制欲望：Q1-Q11 (11题，索引 0-10)
    // 嫉妒强度：Q12-Q22 (11题，索引 11-21)
    // 情感依赖：Q23-Q33 (11题，索引 22-32)
    // 关系安全感：Q34-Q42 (9题，索引 33-41)
    
    const controlAnswers = answers.slice(0, 11);
    const jealousyAnswers = answers.slice(11, 22);
    const dependencyAnswers = answers.slice(22, 33);
    const securityAnswers = answers.slice(33, 42);
    
    console.log('各维度题目数:', {
        control: controlAnswers.length,
        jealousy: jealousyAnswers.length,
        dependency: dependencyAnswers.length,
        security: securityAnswers.length
    });
    
    // 计算各维度原始分数（1-5分制的平均值）
    const controlRaw = calculateAverage(controlAnswers);
    const jealousyRaw = calculateAverage(jealousyAnswers);
    const dependencyRaw = calculateAverage(dependencyAnswers);
    const securityRaw = calculateAverage(securityAnswers);
    
    console.log('原始平均分:', {
        control: controlRaw,
        jealousy: jealousyRaw,
        dependency: dependencyRaw,
        security: securityRaw
    });
    
    // 转换为0-50分制
    // 公式：(平均分 - 1) * (50 / 4) = (平均分 - 1) * 12.5
    const controlScore = Math.round((controlRaw - 1) * 12.5);
    const jealousyScore = Math.round((jealousyRaw - 1) * 12.5);
    const dependencyScore = Math.round((dependencyRaw - 1) * 12.5);
    const securityScore = Math.round((securityRaw - 1) * 12.5);
    
    console.log('转换后分数(0-50):', {
        control: controlScore,
        jealousy: jealousyScore,
        dependency: dependencyScore,
        security: securityScore
    });
    
    return {
        control: {
            score: controlScore,
            percent: Math.round((controlScore / 50) * 100),
            description: getDimensionDescription('control', controlScore)
        },
        jealousy: {
            score: jealousyScore,
            percent: Math.round((jealousyScore / 50) * 100),
            description: getDimensionDescription('jealousy', jealousyScore)
        },
        dependency: {
            score: dependencyScore,
            percent: Math.round((dependencyScore / 50) * 100),
            description: getDimensionDescription('dependency', dependencyScore)
        },
        security: {
            score: securityScore,
            percent: Math.round((securityScore / 50) * 100),
            description: getDimensionDescription('security', securityScore)
        }
    };
}

/**
 * 计算平均分
 */
function calculateAverage(answers) {
    if (!answers || answers.length === 0) {
        console.error('答案数组为空');
        return 1;
    }
    const sum = answers.reduce((acc, val) => acc + (val || 1), 0);
    return sum / answers.length;
}

/**
 * 获取维度描述
 */
function getDimensionDescription(dimensionName, score) {
    const descriptions = {
        control: {
            low: "你给予伴侣充分的自主权，尊重TA的独立性。",
            medium: "你希望参与伴侣的部分决策，但通常能保持界限。",
            high: "你有较强的控制倾向，希望了解和影响伴侣的决策。建议学会尊重对方的独立性，给予更多信任和空间。"
        },
        jealousy: {
            low: "你很少嫉妒，对伴侣充满信任。",
            medium: "你会适度吃醋，但能理性控制情绪。",
            high: "当伴侣与异性接触时，你会感到较强的不安。适度的嫉妒是在乎的表现，但过度会损害信任基础。"
        },
        dependency: {
            low: "你保持着良好的独立性，有自己的生活重心。",
            medium: "你对伴侣有一定依赖，但能保持基本独立。",
            high: "你对伴侣有较强的情感依赖，但尚能保持基本的独立性。继续培养自己的兴趣爱好，保持自我成长空间。"
        },
        security: {
            low: "你对关系充满信心，内心安全稳定。",
            medium: "你的安全感处于正常水平，偶尔会有些担心。",
            high: "你的安全感水平处于中等，偶尔会担心失去对方。建立内在安全感是降低占有欲的关键。"
        }
    };
    
    const level = score < 20 ? 'low' : score < 35 ? 'medium' : 'high';
    return descriptions[dimensionName][level];
}

/**
 * 保存测试结果到localStorage
 */
function saveResult(result) {
    try {
        const history = JSON.parse(localStorage.getItem('rpiTestHistory') || '[]');
        history.unshift(result);
        
        // 只保留最近10次记录
        if (history.length > 10) {
            history.pop();
        }
        
        localStorage.setItem('rpiTestHistory', JSON.stringify(history));
        localStorage.setItem('latestRpiResult', JSON.stringify(result));
        console.log('✅ 结果已保存到localStorage');
    } catch (error) {
        console.error('❌ 保存结果失败:', error);
    }
}

/**
 * 获取历史测试记录
 */
function getTestHistory() {
    try {
        return JSON.parse(localStorage.getItem('rpiTestHistory') || '[]');
    } catch (error) {
        console.error('读取历史记录失败:', error);
        return [];
    }
}

/**
 * 获取最新测试结果
 */
function getLatestResult() {
    try {
        return JSON.parse(localStorage.getItem('latestRpiResult') || 'null');
    } catch (error) {
        console.error('读取最新结果失败:', error);
        return null;
    }
}

// ============================================
// 导出函数（用于模块化或浏览器环境）
// ============================================

if (typeof module !== 'undefined' && module.exports) {
    // Node.js 环境
    module.exports = {
        calculateRPI,
        saveResult,
        getTestHistory,
        getLatestResult,
        enhancedRPIAnalysis,
        dimensionCombinationLibrary,
        dimensionDeepAnalysis,
        generateGoals,
        identifyDimensionPatterns,
        getDimensionDeepAnalysis
    };
}

// 浏览器环境下挂载到window对象
if (typeof window !== 'undefined') {
    window.calculateRPI = calculateRPI;
    window.saveResult = saveResult;
    window.getTestHistory = getTestHistory;
    window.getLatestResult = getLatestResult;
    window.enhancedRPIAnalysis = enhancedRPIAnalysis;
    window.dimensionCombinationLibrary = dimensionCombinationLibrary;
    window.dimensionDeepAnalysis = dimensionDeepAnalysis;
    window.generateGoals = generateGoals;
    window.identifyDimensionPatterns = identifyDimensionPatterns;
    window.getDimensionDeepAnalysis = getDimensionDeepAnalysis;
}

console.log('✅ scoring.js 加载完成');